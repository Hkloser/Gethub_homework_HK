---
title: "Heidi Kloser Homework_5"
author: "Heidi Kloser"
date: "2022-11-15"
output: pdf_document
---

```{r}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE, 
                      error = FALSE)
```


Libraries
```{r}
#packages
library(tidyverse)
library(lubridate)
library(ggthemes)
library(broom)
library(knitr)
library(scales)
library(tigris)
library(sf)
library(viridis)
library(shiny)
library(leaflet)
library(DT)
library(plotly)
library(flexdashboard)
library(jsonlite)
library(maptools)
library(ggplot2)
```

List files in "data" sub directory
```{r}
list.files("data")
```

```{r}
# read in data
homicides<-read.csv("data/homicide-data.csv")


```

Putting map components in 
```{r}
ga_counties <- counties(state = "GA", cb = TRUE, class = "sf")
#getting geographical data from sf/tigris
class(ga_counties)
```

checking county and class data
```{r}
ga_counties %>% 
  slice(1:3)
class(ga_counties$geometry)
```
Making a map of Georgia counties
```{r}
ggplot() + 
  geom_sf(data = ga_counties, aes(fill = ALAND))
```

Incorporating homicide data into map
```{r}
atlanta <- tracts(state = "GA", county = "Fulton", cb = TRUE, class = "sf")
class(atlanta)
```

checking tract and class data
```{r}
atlanta %>% 
  slice(1:3)
class(atlanta$geometry)
```
Making a map of Atlanta
```{r}
atlanta %>% 
ggplot() + 
  geom_sf(data = atlanta, aes(fill = ALAND))+
  xlim(c(-84.6, -84.3)) + ylim(c(33.6, 34.0))
```
Base map for sub layer
```{r}
ga_f <- county_subdivisions(state = "GA", county = "Fulton", cb = TRUE, class = "sf")

ga_f %>% 
ggplot() + 
  geom_sf()+ 
  theme(axis.text.x = element_text(angle = 45))+
  xlim(c(-84.73, -84.3)) + ylim(c(33.6, 34.0))
```
Entering and cleaning data for the homicides
```{r}
# piping n code to clean up data
homicides<- homicides%>%
  mutate(state = str_to_upper(string = state))%>% # changing case
  mutate(city_name = paste(city, state))%>% # combine city and state name to one col
    mutate(status = factor(disposition, levels = c("Closed by arrest", 
                                                      "Closed without arrest", 
                                                      "Open/No arrest"), 
                      labels = c("solved", "unsolved", "unsolved")))%>% 
  # creating new col for solves/unsolved
  filter(str_detect(city_name, "Atlanta"))%>% # filtering to only Atlanta
  select(- city, - state, - disposition) #removing redundant columns


head(homicides, 3)
```

Change to an sf object by saying which columns are the coordinates and setting a CRS:
```{r}
at_hom <- st_as_sf(homicides, coords = c("lon", "lat")) %>%
st_set_crs(4269) #setting CRS
at_hom %>% slice(1:3)
```
Map?
```{r}
#trying to put points on the map
ggplot() + 
  geom_sf(data = ga_f)+ 
  theme(axis.text.x = element_text(angle = 45))+
  xlim(c(-84.73, -84.3)) + ylim(c(33.6, 34.0))+
  geom_sf(data = at_hom, aes(color = victim_race,
                                  shape = status))
```
ggplot() + 
  geom_sf(data = ga_f)+ 
  theme_void()+
  geom_sf(data = homicides, aes(fill = victim_race, group = status, color = victim_race), size = 1)

```


```{r}
st_bbox(atlanta$geometry)
```

```{r}
#Map with HTML
pal <- colorQuantile("YlOrRd", NULL, n = 8)
leaflet(homicides) %>% 
  addTiles() %>% 
  fitBounds(-84.850,33.50,-84.097, 34.185) %>% 
  addTiles()  %>% 
  addCircleMarkers(homicides$lon, 
                   homicides$lat, 
                   color = homicides$status, 
                   radius = 3, 
                   fillOpacity = 0.2,
                   opacity = 0.6,
                   popup = paste(homicides$victim_race,
                                 homicides$status, 
                                 sep = ","))

pal <- colorQuantile("YlOrRd", NULL, n = 8)

leaflet(ufo_us) %>% 
  addTiles() %>%
  addCircleMarkers(color = ~pal(encounter_length))

```

#Map with HTML
pal <- colorQuantile("YlOrRd", NULL, n = 8)
leaflet() %>% 
  addTiles() %>% 
  fitBounds(-102.03,37,-109.03, 41) %>% 
  addTiles() %>% 
  addCircleMarkers(ufo_sightings_co$longitude, 
                   ufo_sightings_co$latitude, 
                   color = ufo_sightings_co$encounter_length, 
                   radius = 3, 
                   fill = T,
                   fillOpacity = 0.2,
                   opacity = 0.6,
                   popup = paste(ufo_sightings_co$city_area,
                                 ufo_sightings_co$sighting_year, 
                                 sep = ",")) 


ggplot() +
  geom_sf(data = bronx_events, aes(fill = events), size = 0.5) +
  geom_sf(data = samp, col = "red", shape = 3)
  
  %>% 
  addCircleMarkers(homicides$lon, 
                   homicides$lat, 
                   color = homicides$status, 
                   radius = 1, 
                   fill = T,
                   fillOpacity = 0.2,
                   opacity = 0.6,
                   popup = paste(homicides$victim_race,
                                 homicides$status, 
                                 sep = ","))
